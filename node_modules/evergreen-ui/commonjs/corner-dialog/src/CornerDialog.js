"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _uiBox = require("ui-box");

var _Transition = _interopRequireDefault(require("react-transition-group/Transition"));

var _layers = require("../../layers");

var _portal = require("../../portal");

var _typography = require("../../typography");

var _buttons = require("../../buttons");

var animationEasing = {
  deceleration: "cubic-bezier(0.0, 0.0, 0.2, 1)",
  acceleration: "cubic-bezier(0.4, 0.0, 1, 1)",
  spring: "cubic-bezier(0.175, 0.885, 0.320, 1.175)"
};
var ANIMATION_DURATION = 240;

var openAnimation = _uiBox.css.keyframes('openAnimation', {
  from: {
    transform: 'translateY(100%)'
  },
  to: {
    transform: 'translateY(0)'
  }
});

var closeAnimation = _uiBox.css.keyframes('closeAnimation', {
  from: {
    transform: 'scale(1)',
    opacity: 1
  },
  to: {
    transform: 'scale(0.9)',
    opacity: 0
  }
});

var animationStyles = {
  '&[data-state="entering"], &[data-state="entered"]': {
    animation: "".concat(openAnimation, " ").concat(ANIMATION_DURATION, "ms ").concat(animationEasing.spring, " both")
  },
  '&[data-state="exiting"]': {
    animation: "".concat(closeAnimation, " 120ms ").concat(animationEasing.acceleration, " both")
  }
};

var CornerDialog =
/*#__PURE__*/
function (_PureComponent) {
  (0, _inherits2.default)(CornerDialog, _PureComponent);

  function CornerDialog(props) {
    var _this;

    (0, _classCallCheck2.default)(this, CornerDialog);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(CornerDialog).call(this, props));
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "handleExited", function () {
      _this.setState({
        exiting: false,
        exited: true
      });

      _this.props.onCloseComplete();
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "handleCancel", function () {
      _this.props.onCancel(_this.handleClose);
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "handleClose", function () {
      _this.setState({
        exiting: true
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "handleConfirm", function () {
      _this.props.onConfirm(_this.handleClose);
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "renderChildren", function () {
      var children = _this.props.children;

      if (typeof children === 'function') {
        return children({
          close: _this.handleClose
        });
      }

      if (typeof children === 'string') {
        return _react.default.createElement(_typography.Paragraph, {
          size: 400,
          color: "muted"
        }, children);
      }

      return children;
    });
    _this.state = {
      exiting: false,
      exited: !props.isShown
    };
    return _this;
  }

  (0, _createClass2.default)(CornerDialog, [{
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      if (!prevProps.isShown && this.props.isShown) {
        // eslint-disable-next-line react/no-did-update-set-state
        this.setState({
          exited: false
        });
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$props = this.props,
          title = _this$props.title,
          width = _this$props.width,
          intent = _this$props.intent,
          isShown = _this$props.isShown,
          hasFooter = _this$props.hasFooter,
          hasCancel = _this$props.hasCancel,
          hasClose = _this$props.hasClose,
          cancelLabel = _this$props.cancelLabel,
          confirmLabel = _this$props.confirmLabel,
          onOpenComplete = _this$props.onOpenComplete,
          containerProps = _this$props.containerProps;
      var _this$state = this.state,
          exiting = _this$state.exiting,
          exited = _this$state.exited;
      if (exited) return null;
      return _react.default.createElement(_portal.Portal, null, _react.default.createElement(_Transition.default, {
        appear: true,
        unmountOnExit: true,
        timeout: ANIMATION_DURATION,
        in: isShown && !exiting,
        onExited: this.handleExited,
        onEntered: onOpenComplete
      }, function (state) {
        return _react.default.createElement(_layers.Card, (0, _extends2.default)({
          role: "dialog",
          backgroundColor: "white",
          elevation: 4,
          width: width,
          css: animationStyles,
          "data-state": state,
          position: "fixed",
          bottom: 16,
          right: 16,
          padding: 32
        }, containerProps), _react.default.createElement(_layers.Pane, {
          display: "flex",
          alignItems: "center",
          marginBottom: 12
        }, _react.default.createElement(_typography.Heading, {
          is: "h4",
          size: 600,
          flex: "1"
        }, title), hasClose && _react.default.createElement(_buttons.IconButton, {
          height: 32,
          icon: "cross",
          appearance: "minimal",
          onClick: _this2.handleClose
        })), _react.default.createElement(_layers.Pane, {
          overflowY: "auto",
          "data-state": state
        }, _this2.renderChildren()), hasFooter && _react.default.createElement(_layers.Pane, {
          marginTop: 24,
          flexShrink: 0,
          display: "flex",
          flexDirection: "row-reverse"
        }, _react.default.createElement(_buttons.Button, {
          appearance: "primary",
          intent: intent,
          marginLeft: 8,
          onClick: _this2.handleConfirm
        }, confirmLabel), hasCancel && _react.default.createElement(_buttons.Button, {
          onClick: _this2.handleCancel
        }, cancelLabel)));
      }));
    }
  }]);
  return CornerDialog;
}(_react.PureComponent);

exports.default = CornerDialog;
CornerDialog.displayName = "CornerDialog";
(0, _defineProperty2.default)(CornerDialog, "propTypes", {
  /**
   * Children can be a string, node or a function accepting `({ close })`.
   * When passing a string, <Paragraph size={400} color="muted" /> is used to wrap the string.
   */
  children: _propTypes.default.oneOfType([_propTypes.default.node, _propTypes.default.func]).isRequired,

  /**
   * The intent of the CornerDialog. Used for the button.
   */
  intent: _propTypes.default.oneOf(['none', 'success', 'warning', 'danger']).isRequired,

  /**
   * When true, the dialog is shown.
   */
  isShown: _propTypes.default.bool,

  /**
   * Title of the Dialog. Titles should use Title Case.
   */
  title: _propTypes.default.node,

  /**
   * Function that will be called when the exit transition is complete.
   */
  onCloseComplete: _propTypes.default.func,

  /**
   * Function that will be called when the enter transition is complete.
   */
  onOpenComplete: _propTypes.default.func,

  /**
   * When true, the footer with the cancel and confirm button is shown.
   */
  hasFooter: _propTypes.default.bool,

  /**
   * Function that will be called when the confirm button is clicked.
   * This does not close the Dialog. A close function will be passed
   * as a paramater you can use to close the dialog.
   *
   * `onConfirm={(close) => close()}`
   */
  onConfirm: _propTypes.default.func,

  /**
   * Label of the confirm button.
   */
  confirmLabel: _propTypes.default.string,

  /**
   * When true, the cancel button is shown.
   */
  hasCancel: _propTypes.default.bool,

  /**
   * When true, the close button is shown.
   */
  hasClose: _propTypes.default.bool,

  /**
   * Function that will be called when the cancel button is clicked.
   * This closes the Dialog by default.
   *
   * `onCancel={(close) => close()}`
   */
  onCancel: _propTypes.default.func,

  /**
   * Label of the cancel button.
   */
  cancelLabel: _propTypes.default.string,

  /**
   * Width of the Dialog.
   */
  width: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.number]),

  /**
   * Props that are passed to the dialog container.
   */
  containerProps: _propTypes.default.object
});
(0, _defineProperty2.default)(CornerDialog, "defaultProps", {
  width: 392,
  intent: 'none',
  hasFooter: true,
  confirmLabel: 'Learn More',
  hasCancel: true,
  hasClose: true,
  cancelLabel: 'Close',
  onCancel: function onCancel(close) {
    return close();
  },
  onConfirm: function onConfirm(close) {
    return close();
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb3JuZXItZGlhbG9nL3NyYy9Db3JuZXJEaWFsb2cuanMiXSwibmFtZXMiOlsiYW5pbWF0aW9uRWFzaW5nIiwiZGVjZWxlcmF0aW9uIiwiYWNjZWxlcmF0aW9uIiwic3ByaW5nIiwiQU5JTUFUSU9OX0RVUkFUSU9OIiwib3BlbkFuaW1hdGlvbiIsImNzcyIsImtleWZyYW1lcyIsImZyb20iLCJ0cmFuc2Zvcm0iLCJ0byIsImNsb3NlQW5pbWF0aW9uIiwib3BhY2l0eSIsImFuaW1hdGlvblN0eWxlcyIsImFuaW1hdGlvbiIsIkNvcm5lckRpYWxvZyIsInByb3BzIiwic2V0U3RhdGUiLCJleGl0aW5nIiwiZXhpdGVkIiwib25DbG9zZUNvbXBsZXRlIiwib25DYW5jZWwiLCJoYW5kbGVDbG9zZSIsIm9uQ29uZmlybSIsImNoaWxkcmVuIiwiY2xvc2UiLCJzdGF0ZSIsImlzU2hvd24iLCJwcmV2UHJvcHMiLCJ0aXRsZSIsIndpZHRoIiwiaW50ZW50IiwiaGFzRm9vdGVyIiwiaGFzQ2FuY2VsIiwiaGFzQ2xvc2UiLCJjYW5jZWxMYWJlbCIsImNvbmZpcm1MYWJlbCIsIm9uT3BlbkNvbXBsZXRlIiwiY29udGFpbmVyUHJvcHMiLCJoYW5kbGVFeGl0ZWQiLCJyZW5kZXJDaGlsZHJlbiIsImhhbmRsZUNvbmZpcm0iLCJoYW5kbGVDYW5jZWwiLCJQdXJlQ29tcG9uZW50IiwiUHJvcFR5cGVzIiwib25lT2ZUeXBlIiwibm9kZSIsImZ1bmMiLCJpc1JlcXVpcmVkIiwib25lT2YiLCJib29sIiwic3RyaW5nIiwibnVtYmVyIiwib2JqZWN0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxJQUFNQSxlQUFlLEdBQUc7QUFDdEJDLEVBQUFBLFlBQVksa0NBRFU7QUFFdEJDLEVBQUFBLFlBQVksZ0NBRlU7QUFHdEJDLEVBQUFBLE1B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LEVBQUUsSUFIUztBQUlwQkksRUFBQUEsWUFBWSxFQUFFLFlBSk07QUFLcEJILEVBQUFBLFNBQVMsRUFBRSxJQUxTO0FBTXBCQyxFQUFBQSxRQUFRLEVBQUUsSUFOVTtBQU9wQkMsRUFBQUEsV0FBVyxFQUFFLE9BUE87QUFRcEJkLEVBQUFBLFFBQVEsRUFBRSxrQkFBQUksS0FBSztBQUFBLFdBQUlBLEtBQUssRUFBVDtBQUFBLEdBUks7QUFTcEJGLEVBQUFBLFNBQVMsRUFBRSxtQkFBQUUsS0FBSztBQUFBLFdBQUlBLEtBQUssRUFBVDtBQUFBO0FBVEksQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBQdXJlQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnXG5pbXBvcnQgeyBjc3MgfSBmcm9tICd1aS1ib3gnXG5pbXBvcnQgVHJhbnNpdGlvbiBmcm9tICdyZWFjdC10cmFuc2l0aW9uLWdyb3VwL1RyYW5zaXRpb24nXG5pbXBvcnQgeyBQYW5lLCBDYXJkIH0gZnJvbSAnLi4vLi4vbGF5ZXJzJ1xuaW1wb3J0IHsgUG9ydGFsIH0gZnJvbSAnLi4vLi4vcG9ydGFsJ1xuaW1wb3J0IHsgUGFyYWdyYXBoLCBIZWFkaW5nIH0gZnJvbSAnLi4vLi4vdHlwb2dyYXBoeSdcbmltcG9ydCB7IEJ1dHRvbiwgSWNvbkJ1dHRvbiB9IGZyb20gJy4uLy4uL2J1dHRvbnMnXG5cbmNvbnN0IGFuaW1hdGlvbkVhc2luZyA9IHtcbiAgZGVjZWxlcmF0aW9uOiBgY3ViaWMtYmV6aWVyKDAuMCwgMC4wLCAwLjIsIDEpYCxcbiAgYWNjZWxlcmF0aW9uOiBgY3ViaWMtYmV6aWVyKDAuNCwgMC4wLCAxLCAxKWAsXG4gIHNwcmluZzogYGN1YmljLWJlemllcigwLjE3NSwgMC44ODUsIDAuMzIwLCAxLjE3NSlgXG59XG5cbmNvbnN0IEFOSU1BVElPTl9EVVJBVElPTiA9IDI0MFxuXG5jb25zdCBvcGVuQW5pbWF0aW9uID0gY3NzLmtleWZyYW1lcygnb3BlbkFuaW1hdGlvbicsIHtcbiAgZnJvbToge1xuICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoMTAwJSknXG4gIH0sXG4gIHRvOiB7XG4gICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgwKSdcbiAgfVxufSlcblxuY29uc3QgY2xvc2VBbmltYXRpb24gPSBjc3Mua2V5ZnJhbWVzKCdjbG9zZUFuaW1hdGlvbicsIHtcbiAgZnJvbToge1xuICAgIHRyYW5zZm9ybTogJ3NjYWxlKDEpJyxcbiAgICBvcGFjaXR5OiAxXG4gIH0sXG4gIHRvOiB7XG4gICAgdHJhbnNmb3JtOiAnc2NhbGUoMC45KScsXG4gICAgb3BhY2l0eTogMFxuICB9XG59KVxuXG5jb25zdCBhbmltYXRpb25TdHlsZXMgPSB7XG4gICcmW2RhdGEtc3RhdGU9XCJlbnRlcmluZ1wiXSwgJltkYXRhLXN0YXRlPVwiZW50ZXJlZFwiXSc6IHtcbiAgICBhbmltYXRpb246IGAke29wZW5BbmltYXRpb259ICR7QU5JTUFUSU9OX0RVUkFUSU9OfW1zICR7XG4gICAgICBhbmltYXRpb25FYXNpbmcuc3ByaW5nXG4gICAgfSBib3RoYFxuICB9LFxuICAnJltkYXRhLXN0YXRlPVwiZXhpdGluZ1wiXSc6IHtcbiAgICBhbmltYXRpb246IGAke2Nsb3NlQW5pbWF0aW9ufSAxMjBtcyAke2FuaW1hdGlvbkVhc2luZy5hY2NlbGVyYXRpb259IGJvdGhgXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29ybmVyRGlhbG9nIGV4dGVuZHMgUHVyZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgLyoqXG4gICAgICogQ2hpbGRyZW4gY2FuIGJlIGEgc3RyaW5nLCBub2RlIG9yIGEgZnVuY3Rpb24gYWNjZXB0aW5nIGAoeyBjbG9zZSB9KWAuXG4gICAgICogV2hlbiBwYXNzaW5nIGEgc3RyaW5nLCA8UGFyYWdyYXBoIHNpemU9ezQwMH0gY29sb3I9XCJtdXRlZFwiIC8+IGlzIHVzZWQgdG8gd3JhcCB0aGUgc3RyaW5nLlxuICAgICAqL1xuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMubm9kZSwgUHJvcFR5cGVzLmZ1bmNdKS5pc1JlcXVpcmVkLFxuXG4gICAgLyoqXG4gICAgICogVGhlIGludGVudCBvZiB0aGUgQ29ybmVyRGlhbG9nLiBVc2VkIGZvciB0aGUgYnV0dG9uLlxuICAgICAqL1xuICAgIGludGVudDogUHJvcFR5cGVzLm9uZU9mKFsnbm9uZScsICdzdWNjZXNzJywgJ3dhcm5pbmcnLCAnZGFuZ2VyJ10pXG4gICAgICAuaXNSZXF1aXJlZCxcblxuICAgIC8qKlxuICAgICAqIFdoZW4gdHJ1ZSwgdGhlIGRpYWxvZyBpcyBzaG93bi5cbiAgICAgKi9cbiAgICBpc1Nob3duOiBQcm9wVHlwZXMuYm9vbCxcblxuICAgIC8qKlxuICAgICAqIFRpdGxlIG9mIHRoZSBEaWFsb2cuIFRpdGxlcyBzaG91bGQgdXNlIFRpdGxlIENhc2UuXG4gICAgICovXG4gICAgdGl0bGU6IFByb3BUeXBlcy5ub2RlLFxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZSBleGl0IHRyYW5zaXRpb24gaXMgY29tcGxldGUuXG4gICAgICovXG4gICAgb25DbG9zZUNvbXBsZXRlOiBQcm9wVHlwZXMuZnVuYyxcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgZW50ZXIgdHJhbnNpdGlvbiBpcyBjb21wbGV0ZS5cbiAgICAgKi9cbiAgICBvbk9wZW5Db21wbGV0ZTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgICAvKipcbiAgICAgKiBXaGVuIHRydWUsIHRoZSBmb290ZXIgd2l0aCB0aGUgY2FuY2VsIGFuZCBjb25maXJtIGJ1dHRvbiBpcyBzaG93bi5cbiAgICAgKi9cbiAgICBoYXNGb290ZXI6IFByb3BUeXBlcy5ib29sLFxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZSBjb25maXJtIGJ1dHRvbiBpcyBjbGlja2VkLlxuICAgICAqIFRoaXMgZG9lcyBub3QgY2xvc2UgdGhlIERpYWxvZy4gQSBjbG9zZSBmdW5jdGlvbiB3aWxsIGJlIHBhc3NlZFxuICAgICAqIGFzIGEgcGFyYW1hdGVyIHlvdSBjYW4gdXNlIHRvIGNsb3NlIHRoZSBkaWFsb2cuXG4gICAgICpcbiAgICAgKiBgb25Db25maXJtPXsoY2xvc2UpID0+IGNsb3NlKCl9YFxuICAgICAqL1xuICAgIG9uQ29uZmlybTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgICAvKipcbiAgICAgKiBMYWJlbCBvZiB0aGUgY29uZmlybSBidXR0b24uXG4gICAgICovXG4gICAgY29uZmlybUxhYmVsOiBQcm9wVHlwZXMuc3RyaW5nLFxuXG4gICAgLyoqXG4gICAgICogV2hlbiB0cnVlLCB0aGUgY2FuY2VsIGJ1dHRvbiBpcyBzaG93bi5cbiAgICAgKi9cbiAgICBoYXNDYW5jZWw6IFByb3BUeXBlcy5ib29sLFxuXG4gICAgLyoqXG4gICAgICogV2hlbiB0cnVlLCB0aGUgY2xvc2UgYnV0dG9uIGlzIHNob3duLlxuICAgICAqL1xuICAgIGhhc0Nsb3NlOiBQcm9wVHlwZXMuYm9vbCxcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgY2FuY2VsIGJ1dHRvbiBpcyBjbGlja2VkLlxuICAgICAqIFRoaXMgY2xvc2VzIHRoZSBEaWFsb2cgYnkgZGVmYXVsdC5cbiAgICAgKlxuICAgICAqIGBvbkNhbmNlbD17KGNsb3NlKSA9PiBjbG9zZSgpfWBcbiAgICAgKi9cbiAgICBvbkNhbmNlbDogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgICAvKipcbiAgICAgKiBMYWJlbCBvZiB0aGUgY2FuY2VsIGJ1dHRvbi5cbiAgICAgKi9cbiAgICBjYW5jZWxMYWJlbDogUHJvcFR5cGVzLnN0cmluZyxcblxuICAgIC8qKlxuICAgICAqIFdpZHRoIG9mIHRoZSBEaWFsb2cuXG4gICAgICovXG4gICAgd2lkdGg6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5zdHJpbmcsIFByb3BUeXBlcy5udW1iZXJdKSxcblxuICAgIC8qKlxuICAgICAqIFByb3BzIHRoYXQgYXJlIHBhc3NlZCB0byB0aGUgZGlhbG9nIGNvbnRhaW5lci5cbiAgICAgKi9cbiAgICBjb250YWluZXJQcm9wczogUHJvcFR5cGVzLm9iamVjdFxuICB9XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICB3aWR0aDogMzkyLFxuICAgIGludGVudDogJ25vbmUnLFxuICAgIGhhc0Zvb3RlcjogdHJ1ZSxcbiAgICBjb25maXJtTGFiZWw6ICdMZWFybiBNb3JlJyxcbiAgICBoYXNDYW5jZWw6IHRydWUsXG4gICAgaGFzQ2xvc2U6IHRydWUsXG4gICAgY2FuY2VsTGFiZWw6ICdDbG9zZScsXG4gICAgb25DYW5jZWw6IGNsb3NlID0+IGNsb3NlKCksXG4gICAgb25Db25maXJtOiBjbG9zZSA9PiBjbG9zZSgpXG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKVxuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGV4aXRpbmc6IGZhbHNlLFxuICAgICAgZXhpdGVkOiAhcHJvcHMuaXNTaG93blxuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHtcbiAgICBpZiAoIXByZXZQcm9wcy5pc1Nob3duICYmIHRoaXMucHJvcHMuaXNTaG93bikge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L25vLWRpZC11cGRhdGUtc2V0LXN0YXRlXG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgZXhpdGVkOiBmYWxzZVxuICAgICAgfSlcbiAgICB9XG4gIH1cblxuICBoYW5kbGVFeGl0ZWQgPSAoKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGV4aXRpbmc6IGZhbHNlLCBleGl0ZWQ6IHRydWUgfSlcbiAgICB0aGlzLnByb3BzLm9uQ2xvc2VDb21wbGV0ZSgpXG4gIH1cblxuICBoYW5kbGVDYW5jZWwgPSAoKSA9PiB7XG4gICAgdGhpcy5wcm9wcy5vbkNhbmNlbCh0aGlzLmhhbmRsZUNsb3NlKVxuICB9XG5cbiAgaGFuZGxlQ2xvc2UgPSAoKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGV4aXRpbmc6IHRydWUgfSlcbiAgfVxuXG4gIGhhbmRsZUNvbmZpcm0gPSAoKSA9PiB7XG4gICAgdGhpcy5wcm9wcy5vbkNvbmZpcm0odGhpcy5oYW5kbGVDbG9zZSlcbiAgfVxuXG4gIHJlbmRlckNoaWxkcmVuID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgY2hpbGRyZW4gfSA9IHRoaXMucHJvcHNcbiAgICBpZiAodHlwZW9mIGNoaWxkcmVuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gY2hpbGRyZW4oeyBjbG9zZTogdGhpcy5oYW5kbGVDbG9zZSB9KVxuICAgIH1cblxuICAgIGlmICh0eXBlb2YgY2hpbGRyZW4gPT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8UGFyYWdyYXBoIHNpemU9ezQwMH0gY29sb3I9XCJtdXRlZFwiPlxuICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgPC9QYXJhZ3JhcGg+XG4gICAgICApXG4gICAgfVxuXG4gICAgcmV0dXJuIGNoaWxkcmVuXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge1xuICAgICAgdGl0bGUsXG4gICAgICB3aWR0aCxcbiAgICAgIGludGVudCxcbiAgICAgIGlzU2hvd24sXG4gICAgICBoYXNGb290ZXIsXG4gICAgICBoYXNDYW5jZWwsXG4gICAgICBoYXNDbG9zZSxcbiAgICAgIGNhbmNlbExhYmVsLFxuICAgICAgY29uZmlybUxhYmVsLFxuICAgICAgb25PcGVuQ29tcGxldGUsXG4gICAgICBjb250YWluZXJQcm9wc1xuICAgIH0gPSB0aGlzLnByb3BzXG5cbiAgICBjb25zdCB7IGV4aXRpbmcsIGV4aXRlZCB9ID0gdGhpcy5zdGF0ZVxuXG4gICAgaWYgKGV4aXRlZCkgcmV0dXJuIG51bGxcblxuICAgIHJldHVybiAoXG4gICAgICA8UG9ydGFsPlxuICAgICAgICA8VHJhbnNpdGlvblxuICAgICAgICAgIGFwcGVhclxuICAgICAgICAgIHVubW91bnRPbkV4aXRcbiAgICAgICAgICB0aW1lb3V0PXtBTklNQVRJT05fRFVSQVRJT059XG4gICAgICAgICAgaW49e2lzU2hvd24gJiYgIWV4aXRpbmd9XG4gICAgICAgICAgb25FeGl0ZWQ9e3RoaXMuaGFuZGxlRXhpdGVkfVxuICAgICAgICAgIG9uRW50ZXJlZD17b25PcGVuQ29tcGxldGV9XG4gICAgICAgID5cbiAgICAgICAgICB7c3RhdGUgPT4gKFxuICAgICAgICAgICAgPENhcmRcbiAgICAgICAgICAgICAgcm9sZT1cImRpYWxvZ1wiXG4gICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcj1cIndoaXRlXCJcbiAgICAgICAgICAgICAgZWxldmF0aW9uPXs0fVxuICAgICAgICAgICAgICB3aWR0aD17d2lkdGh9XG4gICAgICAgICAgICAgIGNzcz17YW5pbWF0aW9uU3R5bGVzfVxuICAgICAgICAgICAgICBkYXRhLXN0YXRlPXtzdGF0ZX1cbiAgICAgICAgICAgICAgcG9zaXRpb249XCJmaXhlZFwiXG4gICAgICAgICAgICAgIGJvdHRvbT17MTZ9XG4gICAgICAgICAgICAgIHJpZ2h0PXsxNn1cbiAgICAgICAgICAgICAgcGFkZGluZz17MzJ9XG4gICAgICAgICAgICAgIHsuLi5jb250YWluZXJQcm9wc31cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPFBhbmUgZGlzcGxheT1cImZsZXhcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgbWFyZ2luQm90dG9tPXsxMn0+XG4gICAgICAgICAgICAgICAgPEhlYWRpbmcgaXM9XCJoNFwiIHNpemU9ezYwMH0gZmxleD1cIjFcIj5cbiAgICAgICAgICAgICAgICAgIHt0aXRsZX1cbiAgICAgICAgICAgICAgICA8L0hlYWRpbmc+XG4gICAgICAgICAgICAgICAge2hhc0Nsb3NlICYmIChcbiAgICAgICAgICAgICAgICAgIDxJY29uQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodD17MzJ9XG4gICAgICAgICAgICAgICAgICAgIGljb249XCJjcm9zc1wiXG4gICAgICAgICAgICAgICAgICAgIGFwcGVhcmFuY2U9XCJtaW5pbWFsXCJcbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5oYW5kbGVDbG9zZX1cbiAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgPC9QYW5lPlxuXG4gICAgICAgICAgICAgIDxQYW5lIG92ZXJmbG93WT1cImF1dG9cIiBkYXRhLXN0YXRlPXtzdGF0ZX0+XG4gICAgICAgICAgICAgICAge3RoaXMucmVuZGVyQ2hpbGRyZW4oKX1cbiAgICAgICAgICAgICAgPC9QYW5lPlxuXG4gICAgICAgICAgICAgIHtoYXNGb290ZXIgJiYgKFxuICAgICAgICAgICAgICAgIDxQYW5lXG4gICAgICAgICAgICAgICAgICBtYXJnaW5Ub3A9ezI0fVxuICAgICAgICAgICAgICAgICAgZmxleFNocmluaz17MH1cbiAgICAgICAgICAgICAgICAgIGRpc3BsYXk9XCJmbGV4XCJcbiAgICAgICAgICAgICAgICAgIGZsZXhEaXJlY3Rpb249XCJyb3ctcmV2ZXJzZVwiXG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBhcHBlYXJhbmNlPVwicHJpbWFyeVwiXG4gICAgICAgICAgICAgICAgICAgIGludGVudD17aW50ZW50fVxuICAgICAgICAgICAgICAgICAgICBtYXJnaW5MZWZ0PXs4fVxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLmhhbmRsZUNvbmZpcm19XG4gICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIHtjb25maXJtTGFiZWx9XG4gICAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgICAgIHtoYXNDYW5jZWwgJiYgKFxuICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e3RoaXMuaGFuZGxlQ2FuY2VsfT57Y2FuY2VsTGFiZWx9PC9CdXR0b24+XG4gICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgIDwvUGFuZT5cbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIDwvQ2FyZD5cbiAgICAgICAgICApfVxuICAgICAgICA8L1RyYW5zaXRpb24+XG4gICAgICA8L1BvcnRhbD5cbiAgICApXG4gIH1cbn1cbiJdfQ==